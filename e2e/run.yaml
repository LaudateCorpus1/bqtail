init:
  target:
    URL: ssh://127.0.0.1/
    credentials: localhost
  appHost: $Hostname($target.URL)
  appPath: $WorkingDirectory(..)

  gcpCredentials: gcp-e2e
  gcp: ${secrets.$gcpCredentials}
  projectID: $gcp.ProjectID
  bucketPrefix: $Replace($projectID,'-','_')
  serviceAccount: $gcp.ClientEmail

  configBucket: ${bucketPrefix}_config
  triggerBucket: ${bucketPrefix}_bqtail
  dispatchBucket: ${bucketPrefix}_bqdispatch
  opsBucket: ${bucketPrefix}_operations
  exportBucket: ${bucketPrefix}_export

pipeline:

  init:
    system:
      action: run
      request: '@system'
      tasks: '*'
    app:
      action: run
      request: '@app'
      tasks: 'deploy'

  test:
    action: run
    request: '@regression/regression'
    tasks: '*'
